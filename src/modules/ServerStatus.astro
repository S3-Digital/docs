---
// src/modules/ServerStatus.astro
const API_KEY = "m802364219-ac34321605f6e02d7d789069"; // Wklej swój klucz tutaj

let statusLabel = "Checking...";
let statusColor = "#888";
let uptimeRatio = "0";

try {
  const response = await fetch("https://api.uptimerobot.com/v2/getMonitors", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    // Dodajemy custom_uptime_ratios=30, aby pobrać statystyki z 30 dni
    body: `api_key=${API_KEY}&format=json&custom_uptime_ratios=30`,
  });

  const data = await response.json();

  if (data.monitors && data.monitors.length > 0) {
    const monitor = data.monitors[0];
    uptimeRatio = monitor.custom_uptime_ratio;

    // Statusy: 2 = Up, 9 = Down
    if (monitor.status === 2) {
      statusLabel = "ONLINE";
      statusColor = "#4caf50";
    } else if (monitor.status === 9) {
      statusLabel = "OFFLINE";
      statusColor = "#f44336";
    } else {
      statusLabel = "MAINTENANCE";
      statusColor = "#ff9800";
    }
  }
} catch (error) {
  console.error("UptimeRobot Error:", error);
  statusLabel = "ERROR";
}
---

<div
  style="background: #111; border: 1px solid #333; padding: 1.2rem; border-radius: 12px; margin: 1rem 0; font-family: sans-serif; max-width: 400px;"
>
  <div
    style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;"
  >
    <div style="display: flex; align-items: center; gap: 12px;">
      <div
        style={`
        width: 12px; 
        height: 12px; 
        border-radius: 50%; 
        background: ${statusColor}; 
        box-shadow: 0 0 10px ${statusColor};
      `}
      >
      </div>
      <span
        style="color: #eee; font-weight: bold; font-size: 0.9rem; letter-spacing: 0.5px;"
      >
        STATUS USŁUGI: {statusLabel}
      </span>
    </div>
    <small style="color: #444; font-size: 0.7rem;">LIVE</small>
  </div>

  <div style="border-top: 1px solid #222; padding-top: 10px; margin-top: 5px;">
    <div
      style="display: flex; justify-content: space-between; align-items: center;"
    >
      <span style="color: #888; font-size: 0.8rem;">Dostępność (30 dni):</span>
      <span
        style={`color: ${parseFloat(uptimeRatio) > 99 ? "#4caf50" : "#ff9800"}; font-weight: bold; font-size: 0.85rem;`}
      >
        {uptimeRatio}%
      </span>
    </div>

    <div
      style="width: 100%; height: 4px; background: #222; border-radius: 2px; margin-top: 6px; overflow: hidden;"
    >
      <div
        style={`width: ${uptimeRatio}%; height: 100%; background: ${statusColor}; transition: width 0.5s ease;`}
      >
      </div>
    </div>
  </div>
</div>
